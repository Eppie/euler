#include <cstdint>
#include <cstdlib>

namespace AE32_128_detail {
static const uint32_t arr[128] = {
    981231,  354316,   1584797,  24882665, 31330835, 1058383,  1418241, 900625,  2188750,  14655726, 2480186,  2046665,
    320090,  3100846,  903858,   43898472, 1182227,  655246,   4544947, 224970,  501686,   6040979,  2696120,  14361,
    3033921, 13171509, 1313116,  4790204,  2998078,  363373,   2314543, 2091089, 51663490, 54540667, 25190930, 6080894,
    1223643, 1069955,  492312,   8153116,  583343,   2056425,  2036702, 469916,  1105698,  1142008,  2146235,  5714931,
    3883365, 2727437,  3646725,  8869469,  2793268,  12237164, 5661300, 490403,  10527007, 1050472,  1803285,  295230,
    1299074, 4112356,  1987030,  2684616,  167348,   9257327,  1093878, 1972379, 4555239,  280427,   2081747,  2122405,
    579707,  18923029, 2043231,  1630278,  6776835,  20838549, 49299,   2711839, 216365,   707735,   12128173, 1074810,
    1541717, 17583491, 2478830,  713755,   2217327,  1753794,  1442512, 1468560, 468893,   3655023,  708215,   1035473,
    5294333, 2113777,  11195975, 3019093,  75722,    2294743,  7173916, 1275571, 370817,   10450738, 1720008,  646052,
    2691776, 5677993,  781077,   33862942, 10729890, 2036073,  194941,  1385450, 244404,   17123424, 5543063,  581857,
    1038344, 19508501, 1478366,  4950334,  800210,   5146506,  3829238, 2788348};

uint16_t hash( uint32_t n ) {
  long long t = n;
  t = ( ( t >> 16 ) ^ t ) * 0xda2e4f1;
  return t % 128;
}

bool is_SPRP( uint32_t n, uint32_t a ) {
  uint32_t d = n - 1;
  uint32_t s = __builtin_ctz( d );
  d >>= s;
  uint64_t cur = 1;
  uint64_t pw = d;
  while( pw ) {
    if( pw & 1 ) {
      cur = ( cur * a ) % n;
    }
    a = ( ( uint64_t ) a * a ) % n;
    pw >>= 1;
  }
  if( cur == 1 ) {
    return true;
  }
  for( uint32_t r = 0; r < s; r++ ) {
    if( cur == n - 1 ) {
      return true;
    }
    cur = ( cur * cur ) % n;
  }
  return false;
}
} // namespace AE32_128_detail

bool AE32_128( uint32_t n ) {
  if( n < 11 ) {
    return ( n == 2 || n == 3 || n == 5 || n == 7 ) ? true : false;
  }
  if( !( n % 2 ) || !( n % 3 ) || !( n % 5 ) || !( n % 7 ) ) {
    return false;
  }
  if( n < 121 ) {
    return true;
  }
  if( !( n % 11 ) || !( n % 13 ) || !( n % 17 ) || !( n % 19 ) || !( n % 23 ) || !( n % 29 ) || !( n % 31 )
      || !( n % 37 ) || !( n % 41 ) || !( n % 43 ) || !( n % 47 ) || !( n % 53 ) ) {
    return false;
  }
  if( n < 3481 ) {
    return true;
  }
  uint16_t h = AE32_128_detail::hash( n );
  uint32_t base = AE32_128_detail::arr[h];
  return AE32_128_detail::is_SPRP( n, base );
}
/*
#include <cstdio>

int main() {
  uint32_t result = 0;
  for( uint32_t i = 0; i < 10000000; ++i ) {
    if( AE32_128( i ) ) {
      ++result;
    }
  }
  printf( "%d\n", result );
}
*/
